<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Underwater Adventure Game</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Courier New', monospace;
            background: linear-gradient(to bottom, #001a33, #003d5c);
            color: #fff;
            margin: 0;
            padding: 0;
            min-height: 100vh;
            overflow-x: hidden;
        }
        
        .container {
            max-width: 900px;
            margin: 20px auto;
            background: rgba(0, 40, 80, 0.9);
            border: 2px solid #0080ff;
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 0 20px rgba(0, 128, 255, 0.5);
        }
        
        h1 {
            text-align: center;
            color: #00ccff;
            margin-bottom: 15px;
            text-shadow: 0 0 10px #00ccff;
            font-size: 24px;
        }
        
        .audio-controls {
            text-align: center;
            margin-bottom: 15px;
            font-size: 12px;
        }
        
        #textArea {
            width: 100%;
            height: 350px;
            background: #000c1a;
            color: #00ff88;
            border: 2px solid #0080ff;
            border-radius: 5px;
            padding: 15px;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            overflow-y: scroll;
            white-space: pre-wrap;
            margin-bottom: 20px;
            line-height: 1.4;
        }
        
        .movement-panel {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 10px;
            margin-bottom: 20px;
            max-width: 300px;
            margin-left: auto;
            margin-right: auto;
        }
        
        .action-panel {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(100px, 1fr));
            gap: 10px;
            margin-bottom: 10px;
        }
        
        button {
            background: linear-gradient(to bottom, #0080ff, #0050cc);
            color: white;
            border: 1px solid #00ccff;
            padding: 10px 5px;
            border-radius: 5px;
            cursor: pointer;
            font-family: 'Courier New', monospace;
            font-weight: bold;
            transition: all 0.2s;
            font-size: 11px;
            text-transform: uppercase;
        }
        
        button:hover {
            background: linear-gradient(to bottom, #00ccff, #0080ff);
            box-shadow: 0 0 10px #00ccff;
        }

        .btn-map {
            background: linear-gradient(to bottom, #00ccff, #0080ff);
            border: 1px solid #ffffff;
        }
        
        .empty-cell {
            visibility: hidden;
        }
        
        /* Modals */
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.85);
        }
        
        .modal-content {
            background: #001a33;
            margin: 5% auto;
            padding: 20px;
            border: 2px solid #00ccff;
            border-radius: 10px;
            width: 90%;
            max-width: 850px;
            max-height: 85vh;
            overflow: auto;
            position: relative;
        }

        .map-pre {
            font-size: 9px;
            line-height: 10px;
            color: #00ff88;
            background: #000;
            padding: 15px;
            border-radius: 5px;
            overflow-x: auto;
        }
        
        .item-button {
            width: 100%;
            margin: 5px 0;
            text-align: left;
            padding: 15px;
        }
        
        .close-modal {
            background: #cc0000;
            border-color: #ff0000;
            margin-top: 15px;
            display: block;
            width: 100%;
        }

        /* Scrollbar styling */
        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: #001a33; }
        ::-webkit-scrollbar-thumb { background: #0080ff; border-radius: 4px; }
    </style>
</head>
<body>

    <div class="container">
        <h1>üåä UNDERWATER ADVENTURE üåä</h1>
        
        <div class="audio-controls">
            <button onclick="toggleMusic()" id="musicToggle">üîä Music: ON</button>
            <input type="range" id="volumeSlider" min="0" max="100" value="30" oninput="changeVolume(this.value)">
            <span id="volumeDisplay">30%</span>
        </div>
        
        <div id="textArea"></div>
        
        <div class="movement-panel">
            <button class="empty-cell"></button>
            <button onclick="move(0)">NORTH ‚Üë</button>
            <button class="empty-cell"></button>
            <button onclick="move(3)">WEST ‚Üê</button>
            <button onclick="move(1)">SOUTH ‚Üì</button>
            <button onclick="move(2)">EAST ‚Üí</button>
        </div>
        
        <div class="action-panel">
            <button onclick="lookAround()">LOOK</button>
            <button onclick="getItem()">GET</button>
            <button onclick="useItem()">USE</button>
            <button onclick="showInventory()">INVENTORY</button>
            <button onclick="examine()">EXAMINE</button>
            <button onclick="talk()">TALK</button>
            <button onclick="openDoor()">OPEN</button>
            <button onclick="closeDoor()">CLOSE</button>
            <button onclick="rest()">REST</button>
            <button onclick="sitStand()">SIT/STAND</button>
            <button onclick="showMap()" class="btn-map">üó∫Ô∏è VIEW MAP</button>
        </div>
    </div>
    
    <!-- Item Modal -->
    <div id="useItemModal" class="modal">
        <div class="modal-content">
            <h2>Select Item to Use</h2>
            <div id="itemList"></div>
            <button class="close-modal" onclick="closeModal()">Cancel</button>
        </div>
    </div>

    <!-- Map Modal -->
    <div id="mapModal" class="modal">
        <div class="modal-content">
            <h2 style="color: #00ccff; margin-bottom: 10px;">World Map</h2>
            <pre class="map-pre" id="mapContent"></pre>
            <button class="close-modal" onclick="closeMapModal()">Return to Game</button>
        </div>
    </div>

    <audio id="backgroundMusic" loop>
        <source src="underwater_theme.mp3" type="audio/mpeg">
    </audio>

    <script>
        // --- GAME DATA ---
        let currentRoom = 2; // Starting at Cave Entrance
        let doorOpen = false;
        let isSitting = false;
        let gameStarted = false;
        let inventory = [];
        let mermaidDialogueCount = 0;
        let musicPlaying = false;

        const asciiMap = `
                     *---------------*     *---------------*                           *---------------*          
                     |  Under Water  |     |     Aqua      |                           |               |          
                     |    Casino     |     |   Clothing    |                           |   Crows Nest  |                           
                     |               |     |     shop      |                           |               |
                     *---------------*     *---------------*                           *---------------*
                         |     |               |     |                                       |   |
                         |     |               |     |                                       |   |  
                         |     |               |     |                                       |   |
*---------------*    *---------------*     *---------------*     *---------------*     *---------------*     *---------------*          
|  Under Water  |____|  Under Water  |_____|      Sea      |_____|               |_____|               |_____|               |          
|   Restaurant  |    |     Lobby     |     | Cave Entrance |     |  Sunken Ship  |     |      Deck     |     |  Captins Room |                           
|               |____|               |_____|               |_____|               |_____|               |-----|               |
*---------------*    *---------------*     *---------------*     *---------------*     *---------------*     *---------------*    
                         |      |              |     |                |     |                |    |
                         |      |              |     |                |     |           *---------------*              
                         |      |              |     |                |     |           |               |               
                         |      |              |     |                |     |           |    Cellar     |                           
                         |      |              |     |                |     |           |               |     
                         |      |              |     |                |     |           *---------------*
                         |      |              |     |                |     |                      
*---------------*    *---------------*     *---------------*     *---------------*     *---------------*          
|  Under Water  |____|  Under Water  |     |     Shark     |_____|  Under Water  |_____|     Turtle    |          
|  Storage Room |    |   Corridor    |     |     Grove     |     |    Garden     |     |     Palace    |                           
|               |____|               |     |               |_____|               |_____|               |
*---------------*    *---------------*     *---------------*     *---------------*     *---------------*             
                                                 |   |                |     |
                                                 |   |                |     |
                                                 |   |                |     |
                                           *---------------*     *---------------*              
                                           |   Sea Dragon  |     |               |               
                                           |     Lair      |     | Mermaid Room  |                           
                                           |               |     |               |     
                                           *---------------*     *---------------*     
                                                                     |      |
                                                                     |      |
                                           *---------------*     *---------------*     *---------------*          
                                           |               |_____|               |_____|               |          
                                           |  Gem Rooom    |     |  Kings Room   |     | Crystal Room  |                           
                                           |               |_____|               |_____|               |
                                           *---------------*     *---------------*     *---------------*
                                                                       |   |
                                                                       |   | 
                                                                       |   |
                                                                 *---------------*              
                                                                 |   Tressure    |               
                                                                 |     Room      |                           
                                                                 |               |     
                                                                 *---------------*`;

        const rooms = [
            "Aquatic Clothing Shop", "Underwater Casino", "Underwater Cave (Car Park)", 
            "Underwater Lobby", "Underwater Restaurant", "Underwater Corridor", 
            "Underwater Storage Room", "Mermaid Room", "Underwater Garden", "Sunken Ship", 
            "Captain's Room", "Crow's Nest", "Deck", "Cellar", "Gem Room", "Treasure Room", 
            "Crystal Room", "King's Room", "Turtle Palace", "Shark Grove", "Sea Dragon's Lair"
        ];
        
        // Connections: [North, South, East, West]
        const roomConnections = [
            [-1, 2, -1, -1],   // 0: Aquatic Clothing Shop
            [-1, 3, -1, -1],   // 1: Casino
            [0, 19, 9, 3],     // 2: Carpark
            [1, 5, 2, 4],      // 3: Lobby
            [-1, -1, 3, -1],   // 4: Restaurant
            [3, -1, -1, 6],    // 5: Corridor
            [-1, -1, 5, -1],   // 6: Storage Room
            [8, 17, -1, -1],   // 7: Mermaid Room
            [9, 7, 18, 19],    // 8: Garden
            [-1, 8, 12, 2],    // 9: Sunken Ship
            [-1, -1, -1, 12],  // 10: Captain's Room
            [-1, 12, -1, -1],  // 11: Crow's Nest
            [11, 13, 10, 9],   // 12: Deck
            [12, -1, -1, -1],  // 13: Cellar
            [-1, -1, 17, -1],  // 14: Gem Room
            [17, -1, -1, -1],  // 15: Treasure Room
            [-1, -1, -1, 17],  // 16: Crystal Room
            [7, 15, 16, 14],   // 17: King's Room
            [-1, -1, -1, 8],   // 18: Turtle Palace
            [2, 20, 8, -1],    // 19: Shark Grove
            [19, -1, -1, -1]   // 20: Sea Dragon's Lair
        ];
        
        const roomDescriptions = {
            0: "the Aquatic Clothing Shop. Racks of neon-glowing wetsuits hang from the walls.",
            1: "the Underwater Casino. The sound of bubbles and digital slot machines fills the air.",
            2: "the Underwater Cave entrance. The current is pulling you; choose if you dare.",
            3: "the grand Underwater Hotel Lobby.",
            4: "the Underwater Restaurant. The smell of kelp soup is surprisingly appetizing.",
            5: "a long, dimly lit Underwater Corridor.",
            6: "the cramped Underwater Storage Room.",
            7: "the Mermaid Room, shimmering with bioluminescent pearls.",
            8: "a tranquil Underwater Garden filled with waving sea anemones.",
            9: "the interior of a massive Sunken Ship.",
            10: "the Captain's Room. You feel a cold shiver while gazing into the shadows.",
            11: "the Crow's Nest. You are at the top of the ship, yet still deep beneath the waves.",
            12: "the Sunken Ship's Deck. The wood is slippery and worn by time.",
            13: "a cold, dark Cellar hidden under worn wooden boards.",
            14: "the Gem Room. Sparkling light reflects off every surface.",
            15: "the Hidden Treasure Room. Legend says a great chest lies here.",
            16: "the Crystal Room, filled with giant, glowing jagged formations.",
            17: "the King's Room. A massive coral throne sits in the center.",
            18: "the Turtle Palace. Gentle sea turtles glide peacefully around you.",
            19: "the Shark Grove. Dark shapes circle above. You should be careful.",
            20: "the Sea Dragon's Lair. The water is warm and dangerous."
        };
        
        const items = {
            "KEY": {name: "KEY", description: "a rusty old key that looks like it might open something", location: 3, canCarry: true},
            "MAGNET": {name: "MAGNET", description: "a magnet floating in the glimmering water", location: 3, canCarry: true},
            "METER": {name: "METER", description: "a sunken parking meter filled with water", location: 2, canCarry: false},
            "MONEY": {name: "MONEY", description: "some shriveled money drifting in the water", location: 1, canCarry: true},
            "GEM": {name: "GEM", description: "a precious gem dug into the floor", location: 14, canCarry: true},
            "CRYSTAL": {name: "CRYSTAL", description: "a crystal glowing with intense light", location: 16, canCarry: true},
            "DRAGONEGG": {name: "DRAGONEGG", description: "a massive, warm dragon egg", location: 20, canCarry: true},
            "HAT": {name: "HAT", description: "a captain's hat, perfectly preserved", location: 10, canCarry: true},
            "CHEST": {name: "CHEST", description: "a heavy treasure chest", location: 15, canCarry: true}
        };

        // --- CORE FUNCTIONS ---

        function setText(text) {
            const area = document.getElementById('textArea');
            area.textContent = text;
            area.scrollTop = area.scrollHeight;
        }

        function showIntroduction() {
            setText(`=== UNDERWATER ADVENTURE ===

Your adventure starts on a train. You fall into a deep sleep and wake up surrounded by darkness. 
After exploring a humid passage, you find an underwater drop-off. 
Luckily, you brought your scuba gear!

Your biggest dream is to meet a mermaid.
The passage draws you in...

=== Click LOOK to begin! ===`);
        }

        function lookAround() {
            gameStarted = true;
            let text = `\n[ LOCATION: ${rooms[currentRoom].toUpperCase()} ]\n`;
            text += `I am in ${roomDescriptions[currentRoom]}\n\n`;
            
            const directions = ["NORTH", "SOUTH", "EAST", "WEST"];
            for (let i = 0; i < 4; i++) {
                if (roomConnections[currentRoom][i] !== -1) {
                    text += `> Exit ${directions[i]} leads to the ${rooms[roomConnections[currentRoom][i]]}.\n`;
                }
            }
            
            let foundItems = false;
            for (let key in items) {
                if (items[key].location === currentRoom) {
                    if (!foundItems) { text += "\nITEMS HERE:\n"; foundItems = true; }
                    text += `- I see ${items[key].description}.\n`;
                }
            }
            setText(text);
        }

        function move(direction) {
            if (!gameStarted) { setText("Please click LOOK to start."); return; }
            if (isSitting) { setText("You can't move while sitting! Stand up first."); return; }

            const nextRoom = roomConnections[currentRoom][direction];
            if (nextRoom !== -1) {
                // Door check logic
                if ((currentRoom === 5 && nextRoom === 6 && !doorOpen) || 
                    (currentRoom === 6 && nextRoom === 5 && !doorOpen)) {
                    setText("\nThe storage door is locked shut.");
                    return;
                }
                currentRoom = nextRoom;
                lookAround();
            } else {
                setText("\nYou can't go that way.");
            }
        }

        function getItem() {
            let found = false;
            for (let key in items) {
                if (items[key].location === currentRoom && items[key].canCarry) {
                    inventory.push(key);
                    items[key].location = -1;
                    setText(`\nYou picked up the ${key}.`);
                    found = true;
                    break;
                }
            }
            if (!found) setText("\nThere is nothing to take here.");
        }

        function showInventory() {
            if (inventory.length === 0) {
                setText("\nYour inventory is empty.");
            } else {
                setText("\nINVENTORY:\n" + inventory.map(i => `- ${i}`).join("\n"));
            }
        }

        function talk() {
            if (currentRoom === 7) {
                const dialogues = [
                    "Mermaid: 'Welcome, land dweller! Let your style shine through!'",
                    "Mermaid: 'The Shark Grove to the east is dangerous. Be careful!'",
                    "Mermaid: 'Have you seen the King's Throne yet?'"
                ];
                setText("\n" + dialogues[mermaidDialogueCount % dialogues.length]);
                mermaidDialogueCount++;
            } else {
                setText("\nThere's no one here to talk to.");
            }
        }

        function openDoor() {
            if (currentRoom === 5 || currentRoom === 6) {
                if (inventory.includes("KEY")) {
                    doorOpen = true;
                    setText("\nYou unlock the door with the rusty key.");
                } else {
                    setText("\nThe door is locked. You need a key.");
                }
            } else {
                setText("\nThere is nothing to open here.");
            }
        }

        function closeDoor() {
            if (currentRoom === 5 || currentRoom === 6) {
                doorOpen = false;
                setText("\nYou closed the door.");
            } else {
                setText("\nThere is nothing to close.");
            }
        }

        function sitStand() {
            if (currentRoom === 17) {
                isSitting = !isSitting;
                setText(isSitting ? "\nYou sit upon the coral throne. You feel like a King!" : "\nYou stand up from the throne.");
            } else {
                setText("\nThere's nowhere to sit here.");
            }
        }

        function rest() {
            setText("\nYou take a moment to rest. The rhythmic sound of bubbles calms you.");
        }

        function examine() {
            setText("\nYou look closer... " + (roomDescriptions[currentRoom] || "You see nothing unusual."));
        }

        // --- MODAL LOGIC ---

        function useItem() {
            if (inventory.length === 0) {
                setText("\nYou have nothing to use.");
                return;
            }
            const list = document.getElementById('itemList');
            list.innerHTML = "";
            inventory.forEach(item => {
                const b = document.createElement('button');
                b.className = "item-button";
                b.textContent = item;
                b.onclick = () => {
                    setText(`\nYou used the ${item}. Nothing happened yet...`);
                    closeModal();
                };
                list.appendChild(b);
            });
            document.getElementById('useItemModal').style.display = 'block';
        }

        function closeModal() { document.getElementById('useItemModal').style.display = 'none'; }

        function showMap() {
            document.getElementById('mapContent').textContent = asciiMap;
            document.getElementById('mapModal').style.display = 'block';
        }

        function closeMapModal() { document.getElementById('mapModal').style.display = 'none'; }

        // --- AUDIO ---
        function toggleMusic() {
            const m = document.getElementById('backgroundMusic');
            const btn = document.getElementById('musicToggle');
            if (musicPlaying) {
                m.pause();
                btn.textContent = "üîá Music: OFF";
            } else {
                m.play().catch(() => alert("Click OK to enable sound."));
                btn.textContent = "üîä Music: ON";
            }
            musicPlaying = !musicPlaying;
        }

        function changeVolume(v) {
            document.getElementById('backgroundMusic').volume = v / 100;
            document.getElementById('volumeDisplay').textContent = v + "%";
        }

        // Initialize
        showIntroduction();

        // Close modals if clicking background
        window.onclick = function(event) {
            if (event.target.className === 'modal') {
                closeModal();
                closeMapModal();
            }
        }
    </script>
</body>
</html>