<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Underwater Adventure Game</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Courier New', monospace;
            background: linear-gradient(to bottom, #001a33, #003d5c);
            color: #fff;
            margin: 0;
            padding: 0;
            min-height: 100vh;
            overflow: hidden;
        }
        
        .page-wrapper {
            height: 100vh;
            overflow: hidden;
            position: relative;
        }
        
        .scroll-container {
            height: 100%;
            overflow-y: hidden;
            position: relative;
        }
        
        .content-wrapper {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            transition: top 0.3s ease;
            padding: 20px;
        }
        
        .scroll-control {
            position: fixed;
            right: 20px;
            top: 50%;
            transform: translateY(-50%);
            z-index: 1000;
            height: 80vh;
            width: 20px;
        }
        
        .scroll-slider {
            -webkit-appearance: slider-vertical;
            writing-mode: bt-lr;
            width: 20px;
            height: 100%;
            cursor: pointer;
            background: rgba(0, 128, 255, 0.3);
            border-radius: 10px;
            outline: none;
        }
        
        .scroll-slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 30px;
            height: 80px;
            background: linear-gradient(to bottom, #00ccff, #0080ff);
            border: 2px solid #00ccff;
            border-radius: 15px;
            cursor: pointer;
            box-shadow: 0 0 10px rgba(0, 204, 255, 0.8);
        }

        /* Map Styling */
        .map-section {
            background: rgba(0, 20, 40, 0.9);
            border: 1px solid #0080ff;
            border-radius: 5px;
            margin: 20px 0;
            padding: 10px;
            overflow-x: auto;
            position: relative;
        }

        .map-header {
            color: #00ccff;
            font-size: 14px;
            margin-bottom: 5px;
            text-align: center;
            text-transform: uppercase;
            letter-spacing: 2px;
        }

        #asciiMap {
            font-family: 'Courier New', monospace;
            font-size: 10px; /* Smaller font to fit more map */
            line-height: 1.1;
            color: #00ff88;
            white-space: pre;
            display: inline-block;
            margin: 0 auto;
        }
        
        .container {
            max-width: 1100px;
            margin: 0 auto;
            background: rgba(0, 40, 80, 0.8);
            border: 2px solid #0080ff;
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 0 20px rgba(0, 128, 255, 0.5);
        }
        
        h1 {
            text-align: center;
            color: #00ccff;
            margin-bottom: 10px;
            text-shadow: 0 0 10px #00ccff;
        }
        
        .audio-controls {
            text-align: center;
            margin-bottom: 15px;
        }
        
        .audio-controls button {
            width: 140px;
            margin: 0 5px;
        }
        
        #textArea {
            width: 100%;
            height: 250px;
            background: #001a33;
            color: #00ff88;
            border: 2px solid #0080ff;
            border-radius: 5px;
            padding: 15px;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            overflow-y: auto;
            white-space: pre-wrap;
            margin-bottom: 20px;
        }
        
        .movement-panel {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 10px;
            margin-bottom: 20px;
            max-width: 300px;
            margin-left: auto;
            margin-right: auto;
        }
        
        .action-panel {
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            gap: 10px;
            margin-bottom: 20px;
        }
        
        button {
            background: linear-gradient(to bottom, #0080ff, #0050cc);
            color: white;
            border: 2px solid #00ccff;
            padding: 12px;
            border-radius: 5px;
            cursor: pointer;
            font-family: 'Courier New', monospace;
            font-weight: bold;
            transition: all 0.3s;
            font-size: 11px;
        }
        
        button:hover {
            background: linear-gradient(to bottom, #00ccff, #0080ff);
            box-shadow: 0 0 15px #00ccff;
        }
        
        .empty-cell { visibility: hidden; }

        .modal {
            display: none;
            position: fixed;
            z-index: 2000;
            left: 0; top: 0; width: 100%; height: 100%;
            background-color: rgba(0, 0, 0, 0.8);
        }
        
        .modal-content {
            background: #001a33;
            margin: 10% auto;
            padding: 20px;
            border: 2px solid #00ccff;
            width: 80%;
            max-width: 400px;
        }
    </style>
</head>
<body>
    <div class="page-wrapper">
        <div class="scroll-container">
            <div class="content-wrapper" id="contentWrapper">
                <div class="container">
                    <h1>üåä UNDERWATER ADVENTURE üåä</h1>
        
                    <div class="audio-controls">
                        <button onclick="toggleMusic()" id="musicToggle">üîä Music: ON</button>
                        <input type="range" id="volumeSlider" min="0" max="100" value="30" oninput="changeVolume(this.value)">
                        <span id="volumeDisplay">30%</span>
                    </div>

                    <!-- Map Integration -->
                    <div class="map-section">
                        <div class="map-header">--- SONAR NAVIGATION CHART ---</div>
                        <div style="text-align: center;">
                            <pre id="asciiMap">
                     *---------------*     *---------------*                           *---------------*          
                     |  Under Water  |     |     Aqua      |                           |               |          
                     |    Casino     |     |   Clothing    |                           |   Crows Nest  |                           
                     |               |     |     shop      |                           |               |
                     *---------------*     *---------------*                           *---------------*
                         |     |               |     |                                       |   |
                         |     |               |     |                                       |   |  
                         |     |               |     |                                       |   |
*---------------*    *---------------*     *---------------*     *---------------*     *---------------*     *---------------*          
|  Under Water  |____|  Under Water  |_____|      Sea      |_____|               |_____|               |_____|               |          
|   Restaurant  |    |     Lobby     |     | Cave Entrance |     |  Sunken Ship  |     |      Deck     |     |  Captins Room |                           
|               |____|               |_____|               |_____|               |_____|               |-----|               |
*---------------*    *---------------*     *---------------*     *---------------*     *---------------*     *---------------*    
                         |      |              |     |                |     |                |    |
                         |      |              |     |                |     |           *---------------*              
                         |      |              |     |                |     |           |               |               
                         |      |              |     |                |     |           |    Cellar     |                           
                         |      |              |     |                |     |           |               |     
                         |      |              |     |                |     |           *---------------*
                         |      |              |     |                |     |                      
*---------------*    *---------------*     *---------------*     *---------------*     *---------------*          
|  Under Water  |____|  Under Water  |     |     Shark     |_____|  Under Water  |_____|     Turtle    |          
|  Storage Room |    |   Corridor    |     |     Grove     |     |    Garden     |     |     Palace    |                           
|               |____|               |     |               |_____|               |_____|               |
*---------------*    *---------------*     *---------------*     *---------------*     *---------------*             
                                                 |   |                |     |
                                                 |   |                |     |
                                                 |   |                |     |
                                           *---------------*     *---------------*              
                                           |   Sea Dragon  |     |               |               
                                           |     Lair      |     | Mermaid Room  |                           
                                           |               |     |               |     
                                           *---------------*     *---------------*     
                                                                     |      |
                                                                     |      |
                                           *---------------*     *---------------*     *---------------*          
                                           |               |_____|               |_____|               |          
                                           |  Gem Rooom    |     |  Kings Room   |     | Crystal Room  |                           
                                           |               |_____|               |_____|               |
                                           *---------------*     *---------------*     *---------------*
                                                                       |   |
                                                                       |   | 
                                                                       |   |
                                                                 *---------------*              
                                                                 |   Tressure    |               
                                                                 |     Room      |                           
                                                                 |               |     
                                                                 *---------------*
                            </pre>
                        </div>
                    </div>
        
                    <div id="textArea"></div>
        
                    <div class="movement-panel">
                        <button class="empty-cell"></button>
                        <button onclick="move(0)">NORTH ‚Üë</button>
                        <button class="empty-cell"></button>
                        <button onclick="move(3)">WEST ‚Üê</button>
                        <button onclick="move(1)">SOUTH ‚Üì</button>
                        <button onclick="move(2)">EAST ‚Üí</button>
                    </div>
        
                    <div class="action-panel">
                        <button onclick="getItem()">GET</button>
                        <button onclick="rest()">REST</button>
                        <button onclick="useItem()">USE</button>
                        <button onclick="openDoor()">OPEN</button>
                        <button onclick="closeDoor()">CLOSE</button>
                        <button onclick="examine()">EXAMINE</button>
                        <button onclick="showInventory()">INVENTORY</button>
                        <button onclick="lookAround()">LOOK</button>
                        <button onclick="sitStand()">SIT/STAND</button>
                        <button onclick="talk()">TALK</button>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Scroll Controls -->
    <div class="scroll-control">
        <input type="range" class="scroll-slider" id="scrollSlider" min="0" max="100" value="0" 
               orient="vertical" oninput="scrollToPosition(this.value)">
    </div>
    
    <div id="useItemModal" class="modal">
        <div class="modal-content">
            <h2 style="color:#00ccff; margin-bottom:10px;">Select Item</h2>
            <div id="itemList"></div>
            <button class="close-modal" onclick="closeModal()" style="margin-top:10px; width:100%; background:#cc0000;">Cancel</button>
        </div>
    </div>

    <audio id="backgroundMusic" loop>
        <source src="underwater_theme.mp3" type="audio/mpeg">
    </audio>

    <script>
        let mermaidDialogueCount = 0;
        let isSitting = false;
        let currentRoom = 2; // Cave Entrance
        let doorOpen = false;
        let gameStarted = false;
        let inventory = [];
        let musicPlaying = false;
        let maxScroll = 0;
        
        window.addEventListener('load', calculateMaxScroll);
        window.addEventListener('resize', calculateMaxScroll);
        
        function calculateMaxScroll() {
            const wrapper = document.getElementById('contentWrapper');
            const container = document.querySelector('.page-wrapper');
            maxScroll = Math.max(0, wrapper.offsetHeight - container.offsetHeight);
        }
        
        function scrollToPosition(value) {
            const wrapper = document.getElementById('contentWrapper');
            const pos = (value / 100) * maxScroll;
            wrapper.style.top = `-${pos}px`;
        }
        
        const rooms = [
            "Aquatic Clothing Shop", "Underwater Casino", "Underwater Cave (Entrance)", 
            "Underwater Lobby", "Underwater Restaurant", "Underwater Corridor", 
            "Underwater Storage Room", "Mermaid Room", "Underwater Garden", "Sunken Ship", 
            "Captain's Room", "Crow's Nest", "Deck", "Cellar", "Gem Room", "Treasure Room", 
            "Crystal Room", "King's Room", "Turtle Palace", "Shark Grove", "Sea Dragon's Lair"
        ];
        
        const roomConnections = [
            [-1, 2, -1, -1], [ -1, 3, -1, -1], [0, 19, 9, 3], [1, 5, 2, 4], [-1, -1, 3, -1],
            [3, -1, -1, 6], [-1, -1, 5, -1], [8, 17, -1, -1], [9, 7, 18, 19], [-1, 8, 12, 2],
            [-1, -1, -1, 12], [-1, 12, -1, -1], [11, 13, 10, 9], [12, -1, -1, -1], [-1, -1, 17, -1],
            [17, -1, -1, -1], [-1, -1, -1, 17], [7, 15, 16, 14], [-1, -1, -1, 8], [2, 20, 8, -1],
            [19, -1, -1, -1]
        ];
        
        const roomDescriptions = {
            0: "Aquatic clothing shop", 1: "Under water seaweed infested casino", 2: "Under water cave entrance",
            3: "Under water hotel lobby", 4: "Under water restaurant", 5: "Under water corridor",
            6: "Under water store room", 7: "Mermaid Room", 8: "Tranquil under water garden",
            9: "Sunken ship", 10: "Captain's room (pirate themed)", 11: "Crow's nest",
            12: "Sunken ship's deck", 13: "Cold dark cellar", 14: "Gem room",
            15: "Hidden treasure room", 16: "Crystal room", 17: "King's room with a throne",
            18: "Turtle Palace", 19: "Shark Grove", 20: "Sea dragon's lair"
        };

        const items = {
            "KEY": {name: "KEY", location: 3, canCarry: true, description: "a rusty old key"},
            "MAGNET": {name: "MAGNET", location: 3, canCarry: true, description: "a floating magnet"},
            "MONEY": {name: "MONEY", location: 1, canCarry: true, description: "shriveled wet money"},
            "GEM": {name: "GEM", location: 14, canCarry: true, description: "a sparkling gem"},
            "CRYSTAL": {name: "CRYSTAL", location: 16, canCarry: true, description: "a glowing crystal"},
            "DRAGONEGG": {name: "DRAGONEGG", location: 20, canCarry: true, description: "a warm dragon egg"}
        };

        function setText(text) {
            const ta = document.getElementById('textArea');
            ta.textContent = text;
            ta.scrollTop = ta.scrollHeight;
        }

        function showIntroduction() {
            setText("=== UNDERWATER ADVENTURE ===\n\nYou wake up in a deep cavern after falling asleep on a train. You have your scuba gear. Your dream is to find a mermaid.\n\nClick LOOK to begin.");
        }

        function lookAround() {
            gameStarted = true;
            if(!musicPlaying) startMusic();
            let text = `\n[ ${rooms[currentRoom].toUpperCase()} ]\n${roomDescriptions[currentRoom]}\n\n`;
            
            const directions = ["NORTH", "SOUTH", "EAST", "WEST"];
            for (let i = 0; i < 4; i++) {
                if (roomConnections[currentRoom][i] !== -1) {
                    text += `Exits: ${directions[i]}\n`;
                }
            }
            
            for (let k in items) {
                if (items[k].location === currentRoom) text += `Item here: ${items[k].description}\n`;
            }
            setText(text);
        }

        function move(direction) {
            if (!gameStarted) return setText("Click LOOK first!");
            if (isSitting) return setText("Stand up first!");
            
            const nextRoom = roomConnections[currentRoom][direction];
            if (nextRoom !== -1) {
                if ((currentRoom === 5 && nextRoom === 6 && !doorOpen) || (currentRoom === 6 && nextRoom === 5 && !doorOpen)) {
                    return setText("\nThe door is locked.");
                }
                currentRoom = nextRoom;
                lookAround();
                
                // Auto-scroll logic: If we move to deep rooms, scroll the page down
                if(currentRoom > 13) {
                    document.getElementById('scrollSlider').value = 60;
                    scrollToPosition(60);
                }
            } else {
                setText("\nYou can't go that way.");
            }
        }

        function getItem() {
            let found = false;
            for (let k in items) {
                if (items[k].location === currentRoom && items[k].canCarry) {
                    inventory.push(items[k].name);
                    items[k].location = -1;
                    setText(`\nYou picked up the ${items[k].name}.`);
                    found = true; break;
                }
            }
            if (!found) setText("\nNothing to take.");
        }

        function showInventory() {
            setText("\nInventory: " + (inventory.length ? inventory.join(", ") : "Empty"));
        }

        function openDoor() {
            if ((currentRoom === 5 || currentRoom === 6) && inventory.includes("KEY")) {
                doorOpen = true;
                setText("\nYou unlocked the door.");
            } else {
                setText("\nYou can't open anything here (or you need a key).");
            }
        }

        function talk() {
            if (currentRoom === 7) {
                const dialogues = ["Hello explorer!", "Beware the sharks!", "Have you seen the King?", "The dragon egg is warm, isn't it?"];
                setText("\nMermaid: " + dialogues[mermaidDialogueCount % dialogues.length]);
                mermaidDialogueCount++;
            } else setText("\nNo one to talk to.");
        }

        function toggleMusic() {
            const m = document.getElementById('backgroundMusic');
            if (musicPlaying) { m.pause(); musicPlaying = false; }
            else { m.play(); musicPlaying = true; }
            document.getElementById('musicToggle').textContent = musicPlaying ? "üîä Music: ON" : "üîá Music: OFF";
        }

        function changeVolume(v) {
            document.getElementById('backgroundMusic').volume = v / 100;
            document.getElementById('volumeDisplay').textContent = v + "%";
        }

        function startMusic() {
            const m = document.getElementById('backgroundMusic');
            m.volume = 0.3;
            m.play().then(() => musicPlaying = true).catch(() => console.log("Blocked"));
        }

        function closeModal() { document.getElementById('useItemModal').style.display = 'none'; }
        
        function useItem() {
            if (!inventory.length) return setText("\nNothing to use.");
            const list = document.getElementById('itemList');
            list.innerHTML = '';
            inventory.forEach(i => {
                const b = document.createElement('button');
                b.style.width = "100%"; b.style.margin = "5px 0";
                b.textContent = i;
                b.onclick = () => { setText(`\nYou used the ${i}.`); closeModal(); };
                list.appendChild(b);
            });
            document.getElementById('useItemModal').style.display = 'block';
        }

        showIntroduction();
    </script>
</body>
</html>